<div class="consent-container">
  <div *ngIf="isLoadingInitialData" class="loading-overlay">
    <div class="spinner"></div>
    <p>{{ 'generic.loading' | translate }}</p>
  </div>

  <div class="consent-form" [class.hidden]="isLoadingInitialData">
    <header class="main-header">
      <div class="header-content">
        <div class="logo-container">
          <img [src]="casinoLogoUrl" (error)="playerPhotoUrl='assets/placeholder/placeholder.jpg'" alt="Casino Logo" class="logo-img">
        </div>
        <div class="player-info-container">
          <h1 class="privacy-title">{{ 'consent.privacyPolicyTitle' | translate }}</h1>
          <p class="casino-name">{{ casinoName }}</p>
          <div class="player-details">
            <p><span class="label">{{ 'consent.pdf.lastNameLabel' | translate }}</span> {{ lastName }}</p>
            <p><span class="label">{{ 'consent.pdf.firstNameLabel' | translate }}</span> {{ firstName }}</p>
            <p><span class="label">{{ 'consent.pdf.identityDocumentLabel' | translate }}</span> {{ cardIdNumber }}</p>
          </div>
        </div>
      </div>
      <div class="text-size-controls">
        <button (click)="setTextSize('small')" [class.active]="getCurrentTextSizeKey() === 'small'">A</button>
        <button (click)="setTextSize('medium')" [class.active]="getCurrentTextSizeKey() === 'medium'">A</button>
        <button (click)="setTextSize('large')" [class.active]="getCurrentTextSizeKey() === 'large'">A</button>
      </div>
    </header>

    <div class="rules-section">
      <div #rulesBody class="rules-body" [style.fontSize.px]="currentTextSizeInPx" (scroll)="onRulesScroll()">
        <p [innerHTML]="rulesText"></p>
      </div>
    </div>

    <div class="agreements-section">
      <div class="checkbox-container">
        <input type="checkbox" id="mandatoryCheckbox" [(ngModel)]="mandatoryCheckbox">
        <label for="mandatoryCheckbox" class="checkbox-label" [style.fontSize.px]="getScaledCheckboxLabelSize()">
          <span class="required-marker">*</span>
          <span class="label-bold">{{ 'consent.pdf.consentLabel' | translate }}</span>
          {{ 'consent.consentDeclarationText' | translate }}
          <span class="required-text-inline">{{ 'generic.requiredText' | translate }}</span>
        </label>
      </div>
      <div class="checkbox-container">
        <input type="checkbox" id="optionalCheckbox" [(ngModel)]="optionalCheckbox">
        <label for="optionalCheckbox" class="checkbox-label" [style.fontSize.px]="getScaledCheckboxLabelSize()">
          <span class="label-bold">{{ 'consent.optionalCommunicationsLabelBold' | translate }}</span>
          {{ 'consent.optionalCommunicationsLabelText' | translate }}
        </label>
      </div>
    </div>

    <div class="signature-section">
      <div class="signature-header">
        <label>{{ 'consent.signatureLabel' | translate }}</label>
        <button (click)="clearSignature()" class="clear-button">{{ 'consent.clearButton' | translate }}</button>
      </div>
      <div #signaturePadWrapper class="signature-pad-wrapper">
        <canvas #signaturePadCanvas></canvas>
      </div>
    </div>

    <footer class="main-footer">
      <button class="validate-button" (click)="onSubmit()" [disabled]="!isSubmitEnabled()" [attr.data-state]="buttonState">
        <span class="button-text">{{ 'consent.validateButton.idle' | translate }}</span>
        <div class="spinner-container" *ngIf="buttonState === 'loading'">
          <div class="spinner"></div>
        </div>
        <div class="success-checkmark" *ngIf="buttonState === 'success'">&#10003;</div>
      </button>
    </footer>
  </div>

  <div *ngIf="showValidationPopup" class="validation-popup">
    <div class="popup-content">
      <div class="success-icon">&#10003;</div>
      <p>{{ validationPopupMessage }}</p>
    </div>
  </div>
</div>
